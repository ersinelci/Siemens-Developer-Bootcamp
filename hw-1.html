<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Ersin</title>
  <link rel="stylesheet" href="css/bootstrap.css" />

  <style>
    .custom-show {
      display: block;
    }

    .custom-hide {
      display: none;
    }

    .highlight {background:rgb(185, 221, 236);}

  </style>
</head>

<body>

  <div class="row">
    <div class="col-md-4 offset-md-4 my-5">
      <div class="card">
        <div class="card-header text-center">
            Ürün Kayıt
          </div>
          <br />
          <h9 class="card-title text-center">
            Lütfen ürün bilgilerini giriniz
          </h9>
 
        <div class="card-body">

          <div id="result">
            <div id="divSucceess" class="alert alert-success custom-hide" role="alert">
              Ürün başarılı kaydedildi.
            </div>
            <div id="divInfo" class="alert alert-info custom-hide" role="alert">
              Ürün başarılı güncellendi.
            </div>
            <div id="divFail" class="alert alert-danger custom-hide" role="alert">
              Bir hata meydana geldi.
            </div>
          </div>

          <form>
            <div class="mb-3">
              <label for="txtName" class="form-label">Ürün ismi :</label>
              <input type="text" class="form-control" id="txtName">
            </div>
            <div id="divPublishError" class="alert alert-danger custom-hide" role="alert">
                Yayınlanma süresi seçilmelidir.
              </div>
            <div id="divNameError" class="alert alert-danger custom-hide" role="alert">
                Ürün ismi 3 karakterden az 10 karakterden fazla olamaz!
              </div>
              <div id="divPriceError" class="alert alert-danger custom-hide" role="alert">
                Ürün fiyatı 100-5000 aralığında olmalıdır!
                </div>
                <div id="divColorError" class="alert alert-danger custom-hide" role="alert">
                    Ürün rengi seçilmelidir.
                  </div>
                  

            <div class="mb-3">
              <label for="txtPrice" class="form-label">Ürün Fiyat :</label>
              <input type="text" class="form-control" id="txtPrice">
            </div>
            <div class="mb-3">
              <label for="dropColorMenu" class="form-label">Ürün Renk :</label>
              <select class="form-control" id="dropColorMenu">
                <option value="">Seçiniz</option>
                <option value="1">Kırmızı</option>
                <option value="2">Mavi</option>
                <option value="3">Yeşil</option>
              </select>
            </div>

            <div class="mb-3 form-check">
              <input type="checkbox" class="form-check-input" id="checkPublish">
              <label class="form-check-label" for="checkPublish">Yayınlansın mı?</label>
            </div>

            <div class="mb-3">
              <p>Yayınlanma süresini seçiniz</p>
              <div class="form-check">
                <input class="form-check-input" value="15" type="radio" name="radioPublishDay">
                <label class="form-check-label" for="flexRadioDefault1">
                  15 gün
                </label>
              </div>
              <div class="form-check">
            <input value="30" class="form-check-input" type="radio" name="radioPublishDay">
                <label class="form-check-label" for="flexRadioDefault2">
                  30 gün
                </label>
              </div>
              <div class="form-check">
                <input value="45" class="form-check-input" type="radio" name="radioPublishDay">
                <label class="form-check-label" for="flexRadioDefault3">
                  45 gün
                </label>
              </div>
            </div> 


            <button id="btnSaveOrUpdate" onclick="saveOrUpdate()" type="button" class="btn btn-primary">Kaydet</button>
            <button type="reset" class="btn btn-warning">Temizle</button>
            <br />
            <br />
          </form>
          <p>Adet:</p>
          <div id="numberOfItems"></div>
      </div>
    </div>
      <table class="table">
        <thead>
          <tr>
            <th>İsim</th>
            <th>Fiyat</th>
            <th>Renk</th>
            <th>Yayında mı?</th>
            <th>Yayın süresi</th>
            <th></th>
          </tr>

        </thead>
        <tbody id="tableBody">
        </tbody>
      </table>
    </div>
</body>
<script>



  var productIncreaseId = 0; // productId identity field
  var updateProductId = 0;
  var productList = [];
  const divSuccess = document.querySelector("#divSucceess")
  const divFail = document.querySelector("#divFail")
  const btnSaveOrUpdate = document.querySelector("#btnSaveOrUpdate");
  let isSaveOrUpdateType = "saveType";
  const arrayBtnAction = [
    { key: "saveType", func: save },
    { key: "updateType", func: update }
  ]
  function btnLoadToForm(id) {
    updateProductId = id;
    btnSaveOrUpdate.textContent = "Güncelle";
    isSaveOrUpdateType = "updateType"
    const productToUpdate = productList.find(x => x.id == id);
    


    document.getElementById("txtName").value = productToUpdate.name;
    document.getElementById("txtPrice").value = productToUpdate.price;
    document.querySelector("#dropColorMenu").value = productToUpdate.color;
    document.querySelector("#checkPublish").checked = productToUpdate.isPublish;
    const radioButtonArray = document.querySelectorAll("input[name='radioPublishDay']")

    radioButtonArray.forEach(x => {
      if (x.value == productToUpdate.publishDay) x.checked = true;
    })


  }

  function highlight(button) {
        button.parentNode.parentNode.className = 'highlight';
    }


  function loadTable() {

    const tableBody = document.querySelector("#tableBody")
    tableBody.innerHTML = '';
    productList.forEach(newProduct => {
      let newRow = document.createElement("tr");
      newRow.innerHTML = `
      <td>${newProduct.name}</td>
      <td>${newProduct.price}</td>
      <td>${newProduct.color}</td>
      <td>${newProduct.isPublish}</td>
      <td>${newProduct.publishDay}</td>
      <td><button id="btnUpdate" onclick="btnLoadToForm(${newProduct.id}); highlight(this);" type="button" class="btn btn-success">Güncelle</button></td>
      <td><button id="btnUpdate" onclick="deleteValidation(${newProduct.id})" type="button" class="btn btn-danger">Sil</button></td>
      `;

      tableBody.appendChild(newRow);
      document.querySelector('#numberOfItems').innerHTML = productList.length;

    })
  }
  function showSuccess() {
    divSuccess.classList.remove("custom-hide");
    divSuccess.classList.add("custom-show");
  }
  function showInfo() {
    divInfo.classList.remove("custom-hide");
    divInfo.classList.add("custom-show");
  }
  function showFail() {
    divFail.classList.remove("custom-hide");
    divFail.classList.add("custom-show")
  }
  
  function showNameError() {
    divNameError.classList.remove("custom-hide");
    divNameError.classList.add("custom-show");
  }
  function showPriceError() {
    divPriceError.classList.remove("custom-hide");
    divPriceError.classList.add("custom-show")
  }
  function showColorError() {
    divColorError.classList.remove("custom-hide");
    divColorError.classList.add("custom-show")
  }
  function showPublishError() {
    divPublishError.classList.remove("custom-hide");
    divPublishError.classList.add("custom-show")
  }
  function reset() {
    document.querySelector("form").reset();
    isSaveOrUpdateType = "saveType"
    btnSaveOrUpdate.textContent = "Kaydet";
    setTimeout(function () {
      divSuccess.classList.remove("custom-show");
      divFail.classList.remove("custom-show");
      divInfo.classList.remove("custom-show");
      divSuccess.classList.add("custom-hide");
      divFail.classList.add("custom-hide");
      divInfo.classList.add("custom-hide");
    }, 2000)
  }

    
  function save() {
    const name = document.getElementById("txtName").value;
    const price = document.getElementById("txtPrice").value;
    const color = document.querySelector("#dropColorMenu").value;
    const isPublish = document.querySelector("#checkPublish").checked;
    const publishDay = document.querySelector("input[name='radioPublishDay']:checked").value;
    const publishStatus = document.querySelector("input[name='radioPublishDay']").checked;
    productIncreaseId++;
    const newProduct = { id: productIncreaseId, name: name, price: price, color: color, isPublish: isPublish, publishDay: publishDay }

    if(isValidName(newProduct) && isValidPrice(newProduct) && isValidColor(newProduct) && isValidPublish(newProduct) == true){
    try {
      console.log(newProduct)
      showSuccess();
      productList.push(newProduct);
      loadTable();

    } catch (error) {
      showFail();
    }
      reset();
  }}



  function update() {


    const name = document.getElementById("txtName").value;
    const price = document.getElementById("txtPrice").value;
    const color = document.querySelector("#dropColorMenu").value;
    const isPublish = document.querySelector("#checkPublish").checked;
    const publishDay = document.querySelector("input[name='radioPublishDay']:checked").value;
    const publishStatus = document.querySelector("input[name='radioPublishDay']:checked");
    let productToUpdateIndex = productList.findIndex(product => product.id == updateProductId);

    productList[productToUpdateIndex].name = name;
    productList[productToUpdateIndex].price = price;
    productList[productToUpdateIndex].color = color;
    productList[productToUpdateIndex].isPublish = isPublish;
    productList[productToUpdateIndex].publishDay = publishDay;

    if(
    isValidName(productList[productToUpdateIndex]) && isValidPrice(productList[productToUpdateIndex]) && isValidColor(productList[productToUpdateIndex]) && isValidPublish(productList[productToUpdateIndex])== true){
    try {
      showInfo();
      loadTable();

    } catch (error) {
      showFail();

    }
      reset();
  }}


  function saveOrUpdate() {
    arrayBtnAction.find(x => x.key == isSaveOrUpdateType).func();
  }

  function deleteValidation(boolConfirm){

  if (confirm("Silmek istediğinizden emin misiniz?")) {
    deleteEntry();
  }
}
    
  function deleteEntry(id) {
    let productToUpdateIndex = productList.findIndex(product => product.id == id);
        productList.splice(productToUpdateIndex, 1);
        loadTable();
  }


  function isValidName(validField) {
    if (validField.name.length <= 3 || validField.name.length >= 10 ){
      showNameError();
      setTimeout(function () {
      divNameError.classList.remove("custom-show");
      divNameError.classList.add("custom-hide");
    }, 2000)}
    else{
      return true
    }}

    function isValidPrice(validField) {
        if (validField.price < 100 || validField.price > 5000){
            showPriceError();
            setTimeout(function () {
      divPriceError.classList.remove("custom-show");
      divPriceError.classList.add("custom-hide");
    }, 2000)}
        
        else{
      return true
    }}
    
    function isValidColor(validField) {
        if (validField.color == ""){
            showColorError();
            setTimeout(function () {
      divColorError.classList.remove("custom-show");
      divColorError.classList.add("custom-hide");
    }, 2000)}
        
        else{
      return true
    }
        }
    
    function isValidPublish(validField){
        
        if (validField.publishStatus == false){
            showPublishError();
            setTimeout(function () {
      divPublishError.classList.remove("custom-show");
      divPublishError.classList.add("custom-hide");
    }, 2000)}
        
        else{
      return true
    }
        }
    

</script>


</html>